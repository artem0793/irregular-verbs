<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <style>
        @import "https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css";

        .valid {
            box-shadow: 0 0 3px green!important;
        }
    </style>
    <script type="text/javascript">
      function tasks(VerbsTask, IrregularVerbsTask, WordTask) {
        var regular_verbs = [
          ['Работа', 'work', 'worked'],
        ];

        var irregular_verbs = [
          ['быть', 'be', 'was|were', 'been'],
          ['носить, рождать', 'bear', 'bore', 'born'],
          ['становиться', 'become', 'became', 'become'],
          ['начинать', 'begin', 'began', 'begun'],
          ['кусать', 'bite', 'bit', 'bitten'],
          ['дуть', 'blow', 'blew', 'blown'],
          ['ломать, разбивать', 'break', 'broke', 'broken'],
          ['приносить', 'bring', 'brought', 'brought'],
          ['строить', 'build', 'built', 'built', ],
          ['покупать', 'buy', 'bought', 'bought'],
          ['ловить', 'catch', 'caught', 'caught'],
          ['выбирать', 'choose', 'chose', 'chosen'],
          ['приходить', 'come', 'came', 'come'],
          ['резать', 'cut', 'cut', 'cut'],
          ['делать', 'do', 'did', 'done'],
          ['пить', 'drink', 'drank', 'drunk'],
          ['водит (машину)', 'drive', 'drove', 'driven'],
          ['кушать', 'eat', 'ate', 'eaten'],
          ['падать', 'fall', 'fell', 'fallen'],
          ['кормить', 'feed', 'fed', 'fed'],
          ['чувствовать', 'feel', 'felt', 'felt'],
          ['находить', 'find', 'found', 'found'],
          ['летать', 'fly', 'flew', 'flown'],
          ['забывать', 'forget', 'forgot', 'forgotten'],
          ['получать', 'get', 'got', 'got'],
          ['давать', 'give', 'gave', 'given'],
          ['идти', 'go', 'went', 'gone'],
          ['расти, вырастать', 'grow', 'grew', 'grown'],
          ['иметь', 'have', 'had', 'had'],
          ['прятать, скрывать', 'hide', 'hid', 'hidden'],
          ['ударять, бить', 'hit', 'hit', 'hit'],
          ['слышать', 'hear', 'heard', 'heard'],
          ['держать', 'hold', 'held', 'held'],
          ['держать, хранить', 'keep', 'kept', 'kept'],
          ['знать', 'know', 'knew', 'known'],
          ['учить, учиться', 'learn', 'learnt', 'learnt'],
          ['уходть, оставлять, уезжать', 'leave', 'left', 'left'],
          ['давать взаймы', 'lend', 'lent', 'lent'],
          ['терять', 'lose', 'lost', 'lost'],
          ['делать, изготавливать', 'make', 'made', 'made'],
          ['встречать', 'meet', 'met', 'met'],
          ['платить', 'pay', 'paid', 'paid'],
          ['класть, ставить', 'put', 'put', 'put'],
          ['увольняться, бросать что-то', 'quit', 'quit', 'quit'],
          ['читать', 'read', 'read', 'read'],
          ['ездить верхом', 'ride', 'rode', 'ridden'],
          ['звонить', 'ring', 'rang', 'rung'],
          ['бегать', 'run', 'ran', 'run'],
          ['сказать', 'say', 'said', 'said'],
          ['видеть', 'see', 'saw', 'seen'],
          ['продавать', 'sell', 'sold', 'sold'],
          ['отправлять, посылать', 'send', 'sent', 'sent'],
          ['петь', 'sing', 'sang', 'sung'],
          ['сидеть', 'sit', 'sat', 'sat'],
          ['спать', 'sleep', 'slept', 'slept'],
          ['говорить', 'speak', 'spoke', 'spoken'],
          ['проводить/тратить (время)', 'spend', 'spent', 'spent'],
          ['воровать, красть', 'steal', 'stole', 'stolen'],
          ['плавать', 'swim', 'swam', 'swum'],
          ['брать', 'take', 'took', 'taken'],
          ['учить (кого-то)', 'teach', 'taught', 'taught'],
          ['сказать (кому-то)', 'tell', 'told', 'told'],
          ['думать', 'think', 'thought', 'thought'],
          ['бросать', 'throw', 'threw', 'thrown'],
          ['понимать', 'understand', 'understood', 'understood'],
          ['просыпаться, будить', 'wake', 'woke', 'woken'],
          ['носить (одежду)', 'wear', 'wore', 'worn'],
          ['побеждать', 'win', 'won', 'won'],
          ['писать', 'write', 'wrote', 'written'],
        ];

        var words = [
            ['машина', 'car'],
        ];

        return [].concat(
          regular_verbs.map(function (item) {
            return new VerbsTask(item[0], item[1], item[2], item[2]);
          }),
          irregular_verbs.map(function (item) {
            return new IrregularVerbsTask(item[0], item[1], item[2], item[3]);
          }),
          words.map(function (item) {
            return new WordTask(item[0], item[1]);
          })
        );
      }
    </script>
    <script type="text/javascript">

      // Осторожно тут говнокод и прочие шалости.
      // Не сравнивать с продакшин проектами.

      (function () {
        "use strict";

        /**
         * It is copy of Function.prototype.bind.
         */
        function proxy(callback, context) {
            return function () {
                return callback.apply(context, arguments);
            };
        }

        /**
         * Will exec after current scope.
         */
        function out_of_scope(callback, context, time) {
          time = time || 0;
          setTimeout(proxy(callback, context), time);
        }


        /**
         * Pseudo inheritance.
         * Просто ES5, по этому так.
         */
        function execute_super(current, parent) {
          var args = Array.from(arguments),
              obj = args.shift();

          obj.__proto__.__proto__ = args.shift().prototype;
          obj.__proto__.__proto__.constructor.apply(obj, args);
        }

        /**
         * Упрощает сложный обьект.
         */
        function inherit(a, b) {
          var output = {}, args = Array.from(arguments)

          args.unshift(output)
          Object.assign.apply(Object, args)

          return output
        }

        /**
         * TaskStorage service.
         */
        function TaskStorage(storage, reset) {
          execute_super(this, Array);

          if (reset === undefined ? false : reset) {
            Array.from(storage).map(proxy(function (task) {
              this.push(task.reset());
            }, this));
          }
          else {
            Array.from(storage).map(proxy(function (task) {
              this.push(task);
            }, this));
          }
        }

        TaskStorage.prototype = {

          constructor: TaskStorage,

          getFilteredByTypes: function (types) {
            return this.getFiltered(function (task) {
              return Array.from(types).includes(task.constructor);
            });
          },

          getUniqueTypes: function () {
            var results = [];

            for (var i = 0; i < this.length; i++) {
              if (!results.includes(this[i].constructor)) {
                results.push(this[i].constructor);
              }
            }

            return results;
          },

          getFiltered: function (callback) {
            return new this.constructor(this.filter(callback));
          },

          getAmountSubmitedItems: function () {
            return this.length - this.getAmountAvailableItems();
          },

          getAmountAvailableItems: function () {
            var amount = this.length;

            for (var i = 0; i < this.length; i++) {
              if (this[i].submited) {
                amount--;
              }
            }

            return amount;
          },

          getAvailableItem: function () {
            var output = null;

            for (var i = 0; i < this.length; i++) {
              if (!this[i].submited) {
                output = this[i];
                break;
              }
            }

            return output;
          }
        };

        /**
         * Task class.
         */
        function Task() {
          this.submited = false;
          this.answer = {};
          this.sortLabel = "";
        }

        Task.prototype = Object.create(EventTarget.prototype)
        Task.prototype.constructor = Task;
        Task.prototype.type = "Без названия";

        Task.prototype.reset = function () {
          this.submited = false;
          this.answer = {};

          return this;
        };

        Task.prototype.render = function (game) {
          return Render("task", {
            type: this.type
          });
        };

        Task.prototype.setSubmit = function (form) {
          this.submited = true;
          this.answer = {};

          this.submit(form);
        };

        Task.prototype.submit = function (form) {};

        Task.prototype.isValid = function () {
          return true;
        };

        Task.prototype.getTable = function () {
          return document.createDocumentFragment();
        };

        Task.prototype.getTableItem = function (tasks) {
          return document.createDocumentFragment();
        };

        /**
         * VerbsTask class.
         */
        function WordTask(translation, word) {
          Task.apply(this, arguments);
          this.sortLabel = word
          this.translation = translation
          this.word = word
        }

        WordTask.prototype = Object.create(Task.prototype)
        WordTask.prototype.constructor = WordTask;
        WordTask.prototype.type = "Просто слова";
        WordTask.prototype.render = function (game) {
          game.layout.updateWidth("700px");

          var output = Render("word_task");

          output.querySelector(".word").innerHTML = this.translation;

          var word = output.querySelector("[name=word]");

          out_of_scope(function() {
            word.focus();
          });
          word.setAttribute("data-validate", this.word);

          word.oninput = proxy(function (event) {
            if (this.compare(event.target.getAttribute("data-validate"), event.target.value)) {
              event.target.classList.add("valid");
            }
            else {
              event.target.classList.remove("valid");
            }
          }, this);

          word.oninput = proxy(function (event) {
            if (this.compare(event.target.getAttribute("data-validate"), event.target.value)) {
              event.target.classList.add("valid");
            }
            else {
              event.target.classList.remove("valid");
            }
          }, this);

          return output;
        };
        WordTask.prototype.isValid = function () {
          return this.submited &&
            this.compare(this.word, this.answer.word);
        };
        WordTask.prototype.submit = function (form) {
          this.answer = {};
          this.answer.word = form.word.value;
        };
        WordTask.prototype.compare = function (data, answer) {
          return data.split('|').map(function (item) { return (item + '').toLowerCase() }).indexOf((answer + '').toLowerCase()) > -1;
        };
        WordTask.prototype.getTable = function () {
          return Render("task_words_table", { type: this.type });
        };
        WordTask.prototype.getTableItem = function (tasks) {
          var rows = [];
          var mapping = {
            word: null,
          }
          for (var t = 0; t < tasks.length; t++) {
            var row = {
              translation: tasks[t].translation,
            };
            for (var prop in mapping) {
              if (mapping.hasOwnProperty(prop)) {
                if (this.compare(tasks[t][prop], tasks[t].answer[prop])) {
                  row[prop] = tasks[t].answer[prop];
                }
                else {
                  row[prop] = document.createRange().createContextualFragment((tasks[t].answer[prop] ? '<s>' + tasks[t].answer[prop] +'</s> ' : '') + tasks[t][prop].replace('|', ', '));
                }
              }
            }

            rows.push(row);
          }

          var output = Render("task_words_table_item", {
            rows: rows.reverse()
          });

          output.querySelectorAll('tbody tr').forEach(function (row, index) {
            row.classList.add(tasks[index].isValid() ? 'positive' : 'negative');
          });

          return output;
        }

        /**
         * VerbsTask class.
         */
        function VerbsTask(translation, infinitive, past_simple, past_participle) {
          Task.apply(this, arguments);
          this.sortLabel = infinitive
          this.translation = translation
          this.infinitive = infinitive
          this.past_simple = past_simple
          this.past_participle = past_participle
        }

        VerbsTask.prototype = Object.create(Task.prototype)
        VerbsTask.prototype.constructor = VerbsTask;
        VerbsTask.prototype.type = "Правильные глаголы";
        VerbsTask.prototype.render = function (game) {
          game.layout.updateWidth("700px");

          var output = Render("verbs_task");

          output.querySelector(".word").innerHTML = this.translation;

          var infinitive = output.querySelector("[name=infinitive]"),
              past_simple = output.querySelector("[name=past_simple]"),
              past_participle = output.querySelector("[name=past_participle]");

          out_of_scope(function() {
            infinitive.focus();
          });
          infinitive.setAttribute("data-validate", this.infinitive);
          past_simple.setAttribute("data-validate", this.past_simple);
          past_participle.setAttribute("data-validate", this.past_participle);
          infinitive.oninput = past_simple.oninput = past_participle.oninput = proxy(function (event) {
            if (this.compare(event.target.getAttribute("data-validate"), event.target.value)) {
              event.target.classList.add("valid");
            }
            else {
              event.target.classList.remove("valid");
            }
          }, this);

          return output;
        };

        VerbsTask.prototype.isValid = function () {
            return this.submited &&
              this.compare(this.infinitive, this.answer.infinitive) &&
              this.compare(this.past_simple, this.answer.past_simple) &&
              this.compare(this.past_participle, this.answer.past_participle);
        };
        VerbsTask.prototype.submit = function (form) {
          this.answer = {};
          this.answer.infinitive = form.infinitive.value;
          this.answer.past_simple = form.past_simple.value;
          this.answer.past_participle = form.past_participle.value;
        };

        VerbsTask.prototype.compare = function (data, answer) {
          return data.split('|').map(function (item) { return (item + '').toLowerCase() }).indexOf((answer + '').toLowerCase()) > -1;
        }

        VerbsTask.prototype.getTable = function () {
          return Render("task_verbs_table", { type: this.type });
        };

        VerbsTask.prototype.getTableItem = function (tasks) {
          var rows = [];
          var mapping = {
            infinitive: null,
            past_simple: null,
            past_participle: null,
          }
          for (var t = 0; t < tasks.length; t++) {
            var row = {
              translation: tasks[t].translation,
            };
            for (var prop in mapping) {
              if (mapping.hasOwnProperty(prop)) {
                if (this.compare(tasks[t][prop], tasks[t].answer[prop])) {
                  row[prop] = tasks[t].answer[prop];
                }
                else {
                  row[prop] = document.createRange().createContextualFragment((tasks[t].answer[prop] ? '<s>' + tasks[t].answer[prop] +'</s> ' : '') + tasks[t][prop].replace('|', ', '));
                }
              }
            }

            rows.push(row);
          }

          var output = Render("task_verbs_table_item", {
            rows: rows.reverse()
          });

          output.querySelectorAll('tbody tr').forEach(function (row, index) {
            row.classList.add(tasks[index].isValid() ? 'positive' : 'negative');
          });

          return output;
        };

        /**
         * IrregularVerbsTask class.
         */
        function IrregularVerbsTask() {
          VerbsTask.apply(this, arguments);
        }

        IrregularVerbsTask.prototype = Object.create(VerbsTask.prototype)
        IrregularVerbsTask.prototype.constructor = IrregularVerbsTask;
        IrregularVerbsTask.prototype.type = "Неправильные глаголы";
        /**
         * Game class.
         */
        function Game(container) {
            this.layout = container.get("layout");
            this.render = container.get("render");
            out_of_scope(function () {
              this.view_default = container.get("view_default");
            }, this);
        }

        Game.prototype = {

          timeOfEnd: 0,

          timer: 0,

          timerHandler: null,

          constructor: Game,

          setStorage: function (storage) {
            this.storage = storage;
          },

          setTimer: function (time) {
            this.timer = time * 60 * 1000;
          },

          getCurrentProgress: function () {
            if (this.timer > 0) {
              var left = this.timeOfEnd - new Date().getTime();

              return this.storage.getAmountAvailableItems()
                ? (this.timer - left) / (this.timer * 0.01)
                : 100.5;
            }

            return (this.storage.length - this.storage.getAmountAvailableItems() + 1) / (this.storage.length * 0.01);
          },

          updateBar: function () {
            this.bar.style.width = this.getCurrentProgress() + "%";
          },

          start: function () {
            if (this.timer > 0) {
              this.timeOfEnd = new Date().getTime() + this.timer;
              this.timerHandler = setInterval(proxy(function () {
                this.updateBar();

                if (this.getCurrentProgress() >= 100) {
                  clearInterval(this.timerHandler);
                }
              }, this), 200);
            }

            this.storage.sort(function () {
              return Math.random() - 0.5;
            });

            var output = this.render("game");

            this.area = output.getElementById("game_form");
            this.form = output.querySelector("form");
            this.bar = output.querySelector(".progress .bar");

            output.querySelector("#stop").onclick = proxy(function (event) {
              event.preventDefault();

              if (this.storage.getAmountSubmitedItems()) {
                this.finish();
              }
              else {
                this.view_default.execute();
              }
            }, this);

            this.form.onsubmit = proxy(function (event) {
              event.preventDefault();
              this.currentTask.setSubmit(this.form);
              this.execute();
            }, this);

            this.execute();
            this.layout.execute(output);
          },

          process: function (task) {
            this.area.innerHTML = "";
            this.area.appendChild(
              task.render(this)
            );
          },

          execute: function () {
            this.updateBar();

            if (this.getCurrentProgress() <= 100) {
              this.currentTask = this.storage.getAvailableItem();
              this.process(this.currentTask);
            }
            else {
              this.finish();
            }
          },

          finish: function () {
            this.storage.sort(function (task_a, task_b) {
              return task_a.sortLabel.localeCompare(task_b.sortLabel);
            });
            this.storage.sort(function (task_a, task_b) {
              return task_a.constructor.name.localeCompare(task_b.constructor.name);
            });

            var total = this.storage.getAmountSubmitedItems(),
                validated = this.storage.getFiltered(function (task) {
                  return task.isValid();
                }).length;

            var types = this.storage.getUniqueTypes();
            var results = document.createDocumentFragment();

            for (var i = 0; i < types.length; i++) {
              var tasks = this.storage.getFilteredByTypes([types[i]]).getFiltered(function (task) {
                return task.submited;
              });

              if (!tasks.length) {
                continue;
              }

              var table = types[i].prototype.getTable();
              var result_table = types[i].prototype.getTableItem(tasks);

              table.querySelector(".results")
                .replaceWith(result_table.querySelector('tbody'));

              results.appendChild(table);
            }


            var output = this.render("game_results", {
              amountError: (total - validated) + "",
              percentSuccess: Math.round(validated / (total / 100)) + "%",
              amountSuccess: validated + "",
              results: results,
            });

            output.querySelector("#exit").onclick = proxy(function (event) {
              event.preventDefault();
              this.view_default.execute();
            }, this);

            this.layout.updateWidth("800px");
            this.layout.execute(output);
          }
        }

        /**
         * Controller class.
         */
        function Controller(container) {
          this.render = container.get("render");
          this.layout = container.get("layout");
          this.view = container.get("view");
        }

        Controller.prototype = {

          constructor: Controller,

          execute: function () {
            var title = this.getTitle(),
                content = this.getContent();

            if (title) {
              this.view.setTitle(title);
            }

            if (content) {
              this.layout.execute(content);
            }
          },

          getTitle: function () {
            return "";
          },

          getContent: function () {
            return this.render("404");
          }
        };

        /**
         * Service Container.
         */
        function Container(list) {
          for (var name in list) {
            if (list.hasOwnProperty(name)) {
              this.register(name, list[name]);
            }
          }
        }

        Container.prototype = {
          constructor: Container,

          _callback: {},

          _services: {},

          get: function (name) {
            if (!this._services[name]) {
              this._services[name] = this._callback.constructor
                ? new (this._callback[name])(this)
                : this._callback[name](this);
            }

            return this._services[name];
          },

          register: function (name, observer) {
            this._callback[name] = observer;
          }
        }

        /**
         * Service UpdateManager.
         */
        function UpdateManager(container) {
          this.date = container.get("datetime");
          this.storage = container.get("local_storage");
        }

        UpdateManager.prototype = {

          constructor: UpdateManager,

          url: "https://api.github.com/repos/artem0793/irregular-verbs/releases/latest",

          checkAvailableRelease: function (reset) {
            reset = reset || false;

            var time = new this.date(),
              cache = this.storage.get("check_update"),
              key = time.getFullYear() + '_' + time.getMonth() + '_' + time.getDate() + '_' + time.getHours();

            if (reset !== true && cache && cache[key]) {
              return Promise.resolve(cache[key]);
            }

            return fetch(this.url)
              .then(function(response) {
                return response.json();
              })
              .then(proxy(function(data) {
                var save = {};
                save[key] = data;
                this.storage.set("check_update", save);

                return save;
              }, this));
          }
        }

        /**
         * Service LocalStorage.
         */
        function LocalStorage(container) {
          this.native_local_storage = container.get("native_local_storage");
          this.serializer = container.get("json_serializer");
        }

        LocalStorage.prototype = {

          constructor: LocalStorage,

          get: function (key) {
            return this.native_local_storage[key]
              ? this.serializer.decode(this.native_local_storage[key])
              : null;
          },

          set: function (key, data) {
            this.native_local_storage[key] = this.serializer.encode(data);
          }
        };

        /**
         * Service JsonSerializer.
         */
        function JsonSerializer(container) {
          this.native_json = container.get("native_json");
        }

        JsonSerializer.prototype = {

          constructor: JsonSerializer,

          decode: function (data) {
            return this.native_json.parse(data);
          },

          encode: function (data) {
            return this.native_json.stringify(data);
          }
        };

        /**
         * Render engine.
         * Не удобная хрень, лучше бы реакт научился бы.
         */
        function Render(name, vars) {
          var template = document.createDocumentFragment();
          vars = vars || {};

          if (name.constructor === String) {
            var source = document.getElementById('theme_' + name);

            if (!source) {
              throw error('Template isn\'t found')
            }

            template = document.createRange().createContextualFragment(source.innerHTML);
          } else {
            template.appendChild(name)
          }

          var keys = Object.keys(vars);

          for (var k = 0; k < keys.length; k++) {
            var key = keys[k];
            if (vars.hasOwnProperty(key)) {
              template.querySelectorAll('[vid-' + key + ']').forEach(function (element) {
                element.removeAttribute('vid-' + key + '')

                if (vars[key].constructor === Array) {
                  for (var i = 0; i < vars[key].length; i++) {
                    element.after(
                      Render(element.cloneNode(true), inherit(vars, vars[key][i]))
                    )
                  }
                  element.parentNode.removeChild(element)
                } else {
                  if (vars[key].constructor !== String) {
                    element.appendChild(vars[key]);
                  }
                  else {
                    element.innerHTML = vars[key];
                  }
                }
              })
            }
          }

          return template
        }

        /**
         * Loader service.
         */
        function Loader() {
          return new Promise(function (resolve) {
            document.addEventListener("DOMContentLoaded", resolve);
          });
        }

        /**
         * View service.
         */
        function View(container) {
          this.document = container.get("document");
          this.loader = container.get("loader");
        }

        View.prototype = {

          constructor: View,

          setup: function () {
            this.loader
              .then(proxy(function () {
              this.body = this.document.querySelector("body");
            }, this))
              .then(proxy(function () {
              this.body.classList.remove("loading");
            }, this));
          },

          setTitle: function (value) {
            this.document.title = value;
          },

          setBody: function (element) {
            this.body.innerHTML = "";

            this.body.append(element);
          },
        }

        /**
         * Application service.
         */
        function Application(container) {
            this.view = container.get("view");
            this.loader = container.get("loader");
            this.controller = container.get("view_default");
        }

        Application.prototype = {

          VERSION: "v1.1",

          constructor: Application,

          start: function () {
            this.view.setup();
            this.loader.then(proxy(function () {
              out_of_scope(function () {
                this.controller.execute();
              }, this);
            }, this));
          }
        }

        /**
         * Application service.
         */
        function Layout(container) {
            this.view = container.get("view");
            this.render = container.get("render");
        }

        Layout.prototype = {

          constructor: Layout,

          name: "default",

          width: "400px",

          currentName: "",

          currentWidth: "",

          execute: function (content) {
            if (this.name !== this.currentName) {
              this.currentName = this.name;
              this.content = this.render("layout_" + this.name, {
                content: content
              });

              this.view.setBody(this.content);
              this.updateWidth();
            }
            else {
              var ref = this.view.body.querySelector("#content");

              ref.innerHTML = "";
              ref.appendChild(content);
            }
          },

          updateWidth: function (width) {
            this.width = width || this.width;

            if (this.width !== this.currentWidth) {
              this.currentWidth = this.width;
              this.view.body.querySelectorAll("#main_column")
                .forEach(proxy(function (element) {
                  element.style.width = this.width;
                }, this));
            }
          }
        };

        /**
         * Игра.
         */
        function GameController(container) {
          execute_super(this, Controller, container);
          this.game = container.get("game");
          out_of_scope(function () {
            this.view_default = container.get("view_default");
          }, this);
        }

        GameController.prototype = {

          constructor: GameController,

          getTitle: function () {
            return "Тренажер";
          },

          getContent: function () {
            this.game.start();

            return null;
          }

        };

        /**
         * Главное меню.
         */
        function DefaultController(container) {
          execute_super(this, Controller, container);
          this.update_manager = container.get("update_manager");
          this.game = container.get("game");
          this.game_storage = container.get("game_storage");

          out_of_scope(function () {
            this.view_game = container.get("view_game");
            this.application = container.get("application");
          }, this);
        }

        DefaultController.prototype = {

          constructor: DefaultController,

          getTitle: function() {
            return "Меню";
          },

          getContent: function () {
            var menu = this.render("general_menu", {
                  version: this.application.VERSION,
                  available: this.application.VERSION,
                  verbsAmount: this.game_storage.getFilteredByTypes([VerbsTask]).length + "",
                  irregularVerbsAmount: this.game_storage.getFilteredByTypes([IrregularVerbsTask]).length + "",
                  wordsAmount: this.game_storage.getFilteredByTypes([WordTask]).length + ""
                }),
                update_area = menu.querySelector(".sub.header"),
                start_link = menu.querySelector("#view_game"),
                update_link = menu.querySelector(".update"),
                restriction = menu.querySelector("#restriction"),
                verbs = menu.querySelector("#verbs"),
                irregular_verbs = menu.querySelector("#irregular_verbs"),
                words = menu.querySelector("#words");

            out_of_scope(function () {
              this.layout.updateWidth("350px");
            }, this);

            update_area.style.display = "none";

            start_link.onclick = proxy(function (event) {
              event.preventDefault();

              var types = [
                verbs.checked ? VerbsTask : null,
                irregular_verbs.checked ? IrregularVerbsTask : null,
                words.checked ? WordTask : null
              ].filter(function (item) {
                return !!item;
              });

              var game_storage = this.game_storage.getFilteredByTypes(types);

              if (game_storage.length) {
                this.game.setStorage(new TaskStorage(game_storage, true));
                if (restriction.selectedOptions[0].value > 0) {
                  this.game.setTimer(parseInt(restriction.selectedOptions[0].value, 10));
                }
                this.view_game.execute();
              }
              else {
                alert("Нет задач в этой категории.");
              }
            }, this);

            try {
              this.update_manager.checkAvailableRelease()
                .then(proxy(function (release) {
                  if (parseFloat((release.tag_name + '').replace(/\w/, ''), 10) > parseFloat(this.application.VERSION.replace('v', ''), 10)) {
                    update_area.style.display = "";
                    update_link.href = "https://github.com/artem0793/irregular-verbs/archive/refs/tags/" + release.tag_name + ".zip";
                  }
                }, this));
            } catch (e) {
                console.log(e);
            }

            return menu;
          }
        };

        (function (container) {
          container.get("application")
            .start();
        })(new Container({
          "document": function () { return document; },
          "datetime": function () { return Date; },
          "native_local_storage": function () { return localStorage; },
          "native_json": function () { return JSON; },
          "json_serializer": JsonSerializer,
          "local_storage": LocalStorage,
          "loader": Loader,
          "view": View,
          "render": function () { return Render },
          "layout": Layout,
          "application": Application,
          "update_manager": UpdateManager,
          "view_default": DefaultController,
          "view_game": GameController,
          "game": Game,
          "game_storage": function () {
            return new TaskStorage(tasks(
              VerbsTask,
              IrregularVerbsTask,
              WordTask
            ));
          },
        }));
      })(tasks);
    </script>

    <script id="theme_404" type="html/template">
        <h1>Page was not found</h1>
    </script>
    <script id="theme_layout_default" type="html/template">
        <div class="ui middle aligned center aligned grid" style="height: 100%">
            <div id="main_column" class="column" style="text-align: left;">
                <div id="content" vid-content></div>
            </div>
            <div class="row">
                <div class="column one">
                    <p>Cообщить об ошибке <a href="mailto:artem0793@gmail.com">artem0793@gmail.com</a></p>
                </div>
            </div>
        </div>
    </script>
    <script id="theme_general_menu" type="html/template">
        <div class="ui inverted segment">
            <span class="ui red ribbon label">Версия: <span vid-version></span></span>
            <h1 class="ui inverted header" style="margin-top:0">
                <span class="sub header">
                    Доступно обновление до <span vid-available></span>
                    <a class="update" target="_blank">скачать</a>
                </span>
                Проверятель 2000
            </h1>
            <form class="ui inverted form">
                <div class="ui horizontal inverted divider">Глаголы</div>
                <div class="field">
                    <div class="ui checkbox">
                        <input type="checkbox" tabindex="0" id="verbs" name="verbs">
                        <label for="verbs">Правильные глаголы <span vid-VerbsAmount></span></label>
                    </div>
                </div>
                <div class="field">
                    <div class="ui checkbox">
                        <input checked type="checkbox" id="irregular_verbs" tabindex="0" name="irregular_verbs">
                        <label for="irregular_verbs">Неправильные глаголы <span vid-irregularVerbsAmount></span></label>
                    </div>
                </div>
                <div class="ui horizontal inverted divider">Существительные</div>
                <div class="field">
                    <div class="ui checkbox">
                        <input type="checkbox" id="words" tabindex="0" name="words">
                        <label for="words">Набор слов <span vid-wordsAmount></span></label>
                    </div>
                </div>
            </form>
            <button style="margin-top: 15px" id="view_game" type="button" class="ui inverted primary basic button">Начать</button>
            <select name="restriction" id="restriction" class="ui dropdown">
                <option value="-1" selected>Все</option>
                <option value="45">45 мин</option>
                <option value="30">30 мин</option>
                <option value="20">20 мин</option>
                <option value="15">15 мин</option>
                <option value="10">10 мин</option>
                <option value="5">5 мин</option>
                <option value="1">1 мин</option>
            </select>
        </div>
    </script>
    <script id="theme_task" type="html/template">
        <h1 vid-type></h1>
    </script>
    <script id="theme_game" type="html/template">
        <form autocomplete="off" class="ui segment huge form">
            <div id="game_form"></div>
            <button class="ui red basic button" id="stop" type="button" tabindex="-1">Остановить</button>
            <button class="ui blue basic submit button" type="submit">Дальше <i class="right arrow icon"></i></button>
            <div class="ui bottom blue small attached progress"><div class="bar"></div></div>
        </form>
    </script>
    <script id="theme_verbs_task" type="html/template">
        <div class="ui stacked blue compact segment" style="display:table;margin-left:auto;margin-right:auto">
            <h3 class="ui header word">Слово</h3>
        </div>
        <div class="three fields">
            <div class="field">
                <label>Infinitive</label>
                <input type="text" name="infinitive">
            </div>
            <div class="field">
                <label>Past Simple</label>
                <input type="text" name="past_simple">
            </div>
            <div class="field">
                <label>Past Participle</label>
                <input type="text" name="past_participle">
            </div>
        </div>
    </script>

    <script id="theme_game_results" type="html/template">
        <div class="ui segment">
            <h1 class="ui header">Результаты</h1>
            <div class="ui column centered grid">
                <div class="column">
                    <div class="ui statistics">
                        <div class="red statistic">
                            <div class="value" vid-amountError></div>
                            <div class="label">Ошибок</div>
                        </div>
                        <div class="blue statistic">
                            <div class="value" vid-percentSuccess></div>
                            <div class="label">Успех</div>
                        </div>
                        <div class="green statistic">
                            <div class="value" vid-amountSuccess></div>
                            <div class="label">Правильных</div>
                        </div>
                    </div>
                </div>
            </div>
            <div vid-results></div>
            <button id="exit" class="ui blue basic submit button" style="margin-top: 15px">Меню</button>
        </div>
    </script>
    <script id="theme_task_verbs_table" type="html/template">
        <h2 class="ui header" vid-type></h2>
        <table class="ui selectable celled table">
            <thead>
            <tr>
                <th>Слово</th>
                <th>Infinitive</th>
                <th>Past Simple</th>
                <th>Past Participle</th>
            </tr>
            </thead>
            <tbody class="results"></tbody>
        </table>
    </script>
    <script id="theme_task_verbs_table_item" type="html/template">
        <table>
            <tr vid-rows>
                <td><p><b vid-translation></b></p></td>
                <td class="infinitive"><p vid-infinitive></p></td>
                <td class="past_simple"><p vid-past_simple></p></td>
                <td class="past_participle"><p vid-past_participle></p></td>
            </tr>
        </table>
    </script>
    <!-- Слово начало -->
    <script id="theme_word_task" type="html/template">
        <div class="ui stacked blue compact segment" style="display:table;margin-left:auto;margin-right:auto">
            <h3 class="ui header word">Слово</h3>
        </div>
        <div class="field" style="margin-bottom: 30px">
            <label>Перевод</label>
            <input type="text" name="word">
        </div>
    </script>
    <script id="theme_task_words_table" type="html/template">
        <h2 class="ui header" vid-type></h2>
        <table class="ui selectable celled table">
            <thead>
            <tr>
                <th>Слово</th>
                <th>Перевод</th>
            </tr>
            </thead>
            <tbody class="results"></tbody>
        </table>
    </script>
    <script id="theme_task_words_table_item" type="html/template">
        <table>
            <tr vid-rows>
                <td><p><b vid-translation></b></p></td>
                <td class="word"><p vid-word></p></td>
            </tr>
        </table>
    </script>
    <!-- Слово конец -->
  </head>
<body class="ui attached inverted loading segment" style="border-width: 0">
</body>
</html>
